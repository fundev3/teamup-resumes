trigger:
  branches:
    include:
      - main
      - develop
      
pr:
  branches:
    include:
      - main
      - develop
  drafts: false

variables:
  projects: '**/*.sln'
  azureSubscription: 'devlevel3-dev (a797242d-ce60-41aa-98ca-2e22d5221cfe)'
  appName: 'team-up-backend-resumes'
  vmImageName: 'ubuntu-latest'

  pool:
    vmImage: $(vmImageName)

steps:
  - task: UseDotNet@2
    displayName: 'Install DotNet'
    inputs:
      packageType: 'sdk'
      version: '3.x'

  - task: DotNetCoreCLI@2
    displayName: 'DotNet Build'
    inputs:
      command: 'build'
      projects: $(projects)
      arguments: '--output $(Build.ArtifactStagingDirectory) $(styleCopEnabled)'

  - task: DotNetCoreCLI@2
    displayName: 'DotNet Tests'
    inputs:
      command: test
      projects:  $(testsProjects)

  - task: PublishBuildArtifacts@1
    displayName: 'DotNet Drop'
    condition: and(succeeded(), ne(variables['Build.Reason'], 'PullRequest'))
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)/build'
      ArtifactName: 'Drop'
  
  - task: ArchiveFiles@2
    inputs:
      rootFolderOrFile: '$(Build.ArtifactStagingDirectory)/build'
      includeRootFolder: false
      archiveType: zip
      archiveFile: $(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip
      replaceExistingArchive: true
  - publish: $(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip
    artifact: drop